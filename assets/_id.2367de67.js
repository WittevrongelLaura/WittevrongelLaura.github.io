import{y as H,z as $,u as ee,l as V,A as te,k as x,s as D,i as se,_ as J,r as S,o as a,c as d,e as T,a as n,t as m,B as I,C,n as L,F as w,m as O,b as M,x as ne,D as oe,w as re,d as ie}from"./index.8c7fcc53.js";import{R as q}from"./RouteHolder.8957e64c.js";import{b as R}from"./query.checklist.6f8adba9.js";import{u as z}from"./useSocket.4eb3b914.js";import{L as ae}from"./loader-2.0652a3c4.js";import{P as le}from"./plus.d021a9a1.js";import"./createVueComponent.12d7077d.js";const ce={props:{checklist:{type:Object,required:!1}},components:{RouteHolder:q,Plus:le,Loader2:ae},setup(i){var B,F,P;const{params:o}=H(),{push:k}=$(),{user:e}=ee(),{result:_}=V(te,{uid:(B=e==null?void 0:e.value)==null?void 0:B.uid});console.log(_);const{result:v,error:p}=V(R,{id:o.id}),g=x(!1),f=x(""),y=x(""),s=D({name:"",userId:"",description:"",categories:""}),l=x(!1),h=x(""),c=t=>["January","February","March","April","May","June","July","August","September","October","November","December"][new Date(t).getMonth()]+" "+new Date(t).getDate()+", "+new Date(t).getFullYear(),j=(t,u)=>t.indexOf(u)===t.length-1,Y=t=>{const u=r.categories.findIndex(b=>b.name===t);r.categories[u].list.push({name:"",check:!1})},G=()=>{var t;(t=r.categories)==null||t.push({name:"Sub-Heading",list:[{name:"",check:!1}]})},K=t=>{console.log(t.target.value);const u=JSON.parse(t.target.value);console.log(u),console.log(r),delete u.id;let b=[];for(let A in u.items)b.push({name:u.items[A],check:!1});console.log(b),r.categories.push({name:u.name,list:b})},Q=t=>{if(l.value&&t===h.value)return!0},E=D(JSON.parse(JSON.stringify((F=i.checklist)==null?void 0:F.categories))),r=D({id:i.checklist.id,name:i.checklist.name,userId:i.checklist.userId,description:i.checklist.description,categories:E}),{connected:W,socketServer:N}=z(),X=async()=>{var t;if(r.id=y.value,W.value==!0){if(U())return;(t=N.value)==null||t.emit("checklist:updateChecklist",r)}};(P=N.value)==null||P.on("checklist:getchecklist",t=>{r.name=t.name,r.description=t.description,r.categories=t.categories});const U=()=>{let t=!1;return r.name===""?(s.name="Name is required",t=!0):s.name="",r.description===""?(s.description="Description is required",t=!0):s.description="",r.categories.length===0?(s.categories="Categories is required",t=!0):s.categories="",r.userId===""?(s.userId="User is required",t=!0):s.userId="",t},Z=async()=>{var t;U()||((t=N.value)==null||t.emit("checklist:updateChecklist",r),k("/trips"))};return se(r,()=>U()),{tripInput:r,loading:g,errorMessage:f,checklistId:y,hover:l,categoryName:h,result:v,TripErrors:s,listInput:E,resultUser:_,submitForm:Z,checkHover:Q,addSubHeading:G,addTask:Y,isItemTheLastOneOfTheList:j,date:c,changed:X,addTemplate:K}}},de={key:0},ue=n("p",null,"Loading",-1),me=[ue],he={class:"mb-6 text-left text-neutral-500"},pe={class:"mb-3"},ge={key:0},fe=["onUpdate:modelValue"],ke={class:"ml-4 flex"},_e={class:"mb-4 flex items-center"},ve=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ye=["onMouseover"],xe={class:""},Ie={key:0,class:"border-1 absolute z-20 w-40 rounded-md border bg-white"},Te={class:"p-2"},Ce=["onClick"],we={class:"text-left"},Se={value:"Add template",class:"",selected:"",disabled:""},Ne=["value"],Ue=["disabled"],De={key:0},Le={key:1};function Oe(i,o,k,e,_,v){var f,y;const p=S("Plus"),g=S("Loader2");return a(),d(w,null,[e.loading?(a(),d("div",de,me)):T("",!0),n("form",{class:"xl:px-32 xl:py-20 md:px-16 md:my-10",onSubmit:o[5]||(o[5]=ne((...s)=>e.submitForm&&e.submitForm(...s),["prevent"])),onChange:o[6]||(o[6]=s=>{var l,h;e.checklistId=(l=e.result)!=null&&l.checklist.id?(h=e.result)==null?void 0:h.checklist.id:"",e.changed()})},[n("div",he,[n("p",null,m(i.$t("trips.created"))+": "+m(e.date((f=e.result)==null?void 0:f.checklist.createdAt)),1),n("p",null,m(i.$t("trips.updated"))+": "+m(e.date((y=e.result)==null?void 0:y.checklist.updatedAt)),1)]),n("div",pe,[I(n("input",{class:L([e.TripErrors.name?"rounded-2xl border-red-500 ring ring-red-500":"","text-5xl font-bold outline-none"]),"onUpdate:modelValue":o[0]||(o[0]=s=>e.tripInput.name=s),type:"text","data-cy":"tripName"},null,2),[[C,e.tripInput.name]])]),I(n("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>e.tripInput.description=s),class:L([e.TripErrors.description?"rounded-2xl border-red-500 ring ring-red-500":"","mb-4 w-full text-xl text-neutral-500 focus-within:outline-none"]),type:"text","data-cy":"tripDescription"},null,2),[[C,e.tripInput.description]]),e.tripInput.categories.length>0?(a(),d("div",ge,[(a(!0),d(w,null,O(e.tripInput.categories,s=>(a(),d("div",{key:s.id},[I(n("input",{class:L(["mb-3 font-medium focus-within:outline-none",e.TripErrors.name?"rounded-2xl border-red-500 ring ring-red-500":""]),"data-cy":"tripCategory",type:"text","onUpdate:modelValue":l=>s.name=l},null,10,fe),[[C,s.name]]),(a(!0),d(w,null,O(s.list,l=>{var h;return a(),d("ul",{key:l.id},[n("li",ke,[n("div",_e,[I(n("input",{type:"checkbox","data-cy":"checkbox",class:"accent-green700 h-4 w-4","onUpdate:modelValue":c=>l.check=c},null,8,ve),[[oe,l.check]]),I(n("input",{type:"text",class:"border-b-1 ml-2 border-b-neutral-300 outline-none","onUpdate:modelValue":c=>l.name=c,"data-cy":"tripTask"},null,8,be),[[C,l.name]]),e.isItemTheLastOneOfTheList(s.list,l)?(a(),d("div",{key:0,class:"ml-2",onMouseover:c=>{e.hover=!0,e.categoryName=s.name},onMouseleave:o[4]||(o[4]=c=>e.hover=!1)},[n("div",xe,[M(p,{class:"z-10 self-baseline hover:cursor-pointer"})]),e.checkHover(s.name)?(a(),d("div",Ie,[n("ul",Te,[n("li",null,[n("button",{onClick:c=>e.addTask(s.name)},[n("p",null,m(i.$t("trips.addTask")),1)],8,Ce)]),n("li",null,[n("button",{onClick:o[2]||(o[2]=c=>e.addSubHeading())},[n("p",null,m(i.$t("trips.addSubheading")),1)])]),n("li",we,[n("select",{name:"template",id:"template",class:"-ml-1",onChange:o[3]||(o[3]=c=>e.addTemplate(c))},[n("option",Se,m(i.$t("trips.addTemplate")),1),(a(!0),d(w,null,O((h=e.resultUser)==null?void 0:h.findByUid.templates,c=>(a(),d("option",{value:JSON.stringify(c)},m(c.name),9,Ne))),256))],32)])])])):T("",!0)],40,ye)):T("",!0)])])])}),128))]))),128))])):T("",!0),n("button",{class:"bg-greenPrimary hover:bg-green700 mt-6 flex flex-1 w-full items-center justify-center rounded-md py-2 px-3 text-white outline-none ring-neutral-300 focus-visible:ring",disabled:e.loading,"data-cy":"saveTrip"},[e.loading?(a(),d("div",Le,[M(g,{class:"animate-spin"})])):(a(),d("span",De,m(i.$t("trips.save")),1))],8,Ue)],32)],64)}const Ve=J(ce,[["render",Oe]]),Me={components:{RouteHolder:q,ChecklistPage:Ve},setup(){var v,p;const{socketServer:i}=z(),{params:o}=H(),{result:k,error:e,loading:_}=V(R,{id:o.id});return(v=i.value)==null||v.emit("checklist:getchecklist",o),(p=i.value)==null||p.on("checklist:getchecklist",g=>{k.value={checklist:g}}),{result:k,loading:_,error:e}}},Ee={class:"flex flex-1 justify-center"};function Be(i,o,k,e,_,v){const p=S("ChecklistPage"),g=S("route-holder");return a(),d("div",Ee,[M(g,{class:"md:mx-40 my-10 md:mb-16 xl:mb-30 flex flex-1 max-w-[1190px] bg-white p-40 shadow-lg"},{default:re(()=>{var f;return[e.loading?T("",!0):(a(),ie(p,{key:0,checklist:(f=e.result)==null?void 0:f.checklist},null,8,["checklist"]))]}),_:1})])}const ze=J(Me,[["render",Be]]);export{ze as default};
